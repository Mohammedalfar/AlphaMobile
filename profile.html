<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alpha Mobile • Profile</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <style>
    /* [existing styles from original profile.html] */
    :root{ --pistachio: #93C572; --bg: #fbfefb; --text: #0f172a; --card: #ffffff; --muted: #64748b; --border: rgba(0,0,0,0.08); }
    [data-theme="dark"]{ --bg: #0a0e17; --card: #111827; --text: #f8fafc; --muted: #94a3b8; --border: rgba(255,255,255,0.1); }
    body{ font-family:'Inter',sans-serif; background:var(--bg); color:var(--text); margin:0; padding:20px; display:flex; justify-content:center; }
    
    .profile-container { width:100%; max-width:600px; margin-top:40px; }
    
    .user-card { background: var(--card); border: 1px solid var(--border); border-radius: 32px; padding: 40px; text-align: center; position: relative; overflow: hidden; }
    .avatar { width: 100px; height: 100px; background: linear-gradient(135deg, var(--pistachio), #A8D5A2); border-radius: 50%; margin: 0 auto 20px; display: grid; place-items: center; font-size: 40px; color: white; font-weight: 900; }
    
    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px; }
    .stat-box { background: var(--bg); padding: 20px; border-radius: 20px; border: 1px solid var(--border); }
    .stat-val { font-size: 28px; font-weight: 900; color: var(--text); }
    .stat-lbl { font-size: 13px; color: var(--muted); font-weight: 600; text-transform: uppercase; margin-top: 5px; }

    .btn-logout { background: #ef4444; color: white; padding: 12px 24px; border-radius: 99px; border: none; font-weight: 700; cursor: pointer; margin-top: 30px; }
    .btn-home { background: transparent; color: var(--text); border: 1px solid var(--border); padding: 12px 24px; border-radius: 99px; font-weight: 700; cursor: pointer; margin-top: 10px; margin-left: 10px; text-decoration: none; display: inline-block;}
    
    .loader { margin-top: 50px; color: var(--muted); font-weight: 600; }
    #p-username { font-weight: 700; color: var(--pistachio); margin-bottom: 5px; }  /* New style for username */
  </style>
</head>
<body>

  <div class="profile-container" id="container">
    <div class="user-card">
      <div id="loader" class="loader">Loading Profile...</div>
      
      <div id="content" style="display:none;">
        <div class="avatar" id="p-initial">?</div>
        <h1 id="p-name" style="margin:0">User</h1>
        <div id="p-username">Username</div>  <!-- New: Show username -->
        <p id="p-email" style="color:var(--muted); margin-top:5px;">...</p>
        <p id="p-phone" style="color:var(--muted); margin-top:5px;">Phone: ...</p>  <!-- Show phone -->

        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-val" id="s-count">0</div>
            <div class="stat-lbl">Total Orders</div>
          </div>
          <div class="stat-box">
            <div class="stat-val" id="s-spent">€0</div>
            <div class="stat-lbl">Total Spent</div>
          </div>
        </div>

        <button class="btn-logout" id="btn-logout">Sign Out</button>
        <a href="shop.html" class="btn-home">Back to Shop</a>
      </div>
    </div>
  </div>

  <script type="module">
    import { subscribeToAuth, getUserProfile, logoutUser } from './db.js';

    subscribeToAuth(async (user) => {
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      const profile = await getUserProfile(user.uid);
      
      if(profile) {
        document.getElementById('p-name').innerText = profile.name || "Valued Customer";
        document.getElementById('p-username').innerText = profile.username || "No Username";
        document.getElementById('p-email').innerText = profile.email;
        document.getElementById('p-phone').innerText = "Phone: " + (profile.phone || "Not set");
        document.getElementById('p-initial').innerText = (profile.name || "U")[0].toUpperCase();
        document.getElementById('s-count').innerText = profile.ordersCount || 0;
        document.getElementById('s-spent').innerText = "€" + (profile.totalSpent || 0);
      } else {
        document.getElementById('p-name').innerText = "User";
        document.getElementById('p-email').innerText = user.email;
        document.getElementById('p-username').innerText = "No Username";
      }

      document.getElementById('loader').style.display = 'none';
      document.getElementById('content').style.display = 'block';
    });

    document.getElementById('btn-logout').onclick = async () => {
      await logoutUser();
      localStorage.removeItem('alphaUser');
      window.location.href = 'index.html';
    };
  </script>
</body>
</html>