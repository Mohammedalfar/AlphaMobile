<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Alpha Admin • Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #93C572; --border: #334155; }
    body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; padding: 40px; display:flex; justify-content:center;}
    
    input, select { width: 100%; padding: 12px; margin: 5px 0 15px; background: var(--bg); border: 1px solid var(--border); color: white; border-radius: 8px; box-sizing:border-box;}
    input[type="file"] { background: #334155; cursor: pointer; }
    
    button { width: 100%; padding: 12px; background: var(--accent); border: none; font-weight: 700; color: white; border-radius: 8px; cursor: pointer; transition:0.2s;}
    button:hover { opacity: 0.9; }
    button:disabled { background: #64748b; cursor: wait; }

    .container { max-width: 900px; width: 100%; display: grid; grid-template-columns: 1fr 2fr; gap:30px; }
    .card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid var(--border); }
    
    .item-row { display: flex; align-items: center; gap: 15px; padding: 10px; border-bottom: 1px solid var(--border); }
    .item-img { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; background: #333; }
    .del-btn { background:#ef4444; width:auto; padding:5px 12px; font-size:12px;}
  </style>
</head>
<body>

  <div class="container">
    <div class="card">
      <h3 style="margin-top:0">Add New Product</h3>
      
      <label>Name</label> 
      <input type="text" id="p-name" placeholder="iPhone 15">
      
      <label>Category</label>
      <select id="p-type">
        <option value="phone">Phone</option>
        <option value="audio">Audio</option>
        <option value="cable">Cable</option>
        <option value="charger">Charger</option>
      </select>
      
      <label>Price (€)</label> 
      <input type="number" id="p-price" placeholder="999">
      
      <label>Stock Qty</label> 
      <input type="number" id="p-stock" value="5">
      
      <label>Photo</label>
      <input type="file" id="p-file" accept="image/*">
      
      <label>Description</label> 
      <input type="text" id="p-desc" placeholder="Details...">
      
      <button id="addBtn">Upload & Save</button>
    </div>

    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0">Database Items</h3>
        <a href="shop.html" target="_blank" style="color:#93C572; text-decoration:none; font-size:14px;">View Shop &rarr;</a>
      </div>
      <div id="list-area">Loading...</div>
    </div>
  </div>

  <script type="module">
    import { getProducts, addProductToDB, deleteProductFromDB, uploadImage } from './db.js';

    // 1. Load Data
    async function load() {
      const list = document.getElementById('list-area');
      list.innerHTML = "Fetching...";
      try {
        const products = await getProducts();
        
        list.innerHTML = "";
        if(products.length === 0) list.innerHTML = "Database is empty.";

        products.forEach(p => {
          const div = document.createElement('div');
          div.className = 'item-row';
          div.innerHTML = `
            <img src="${p.image}" class="item-img">
            <div style="flex:1"><b>${p.name}</b><br><small>€${p.price}</small></div>
            <button class="del-btn" data-id="${p.id}">Delete</button>
          `;
          list.appendChild(div);
        });

        document.querySelectorAll('.del-btn').forEach(b => {
          b.addEventListener('click', async (e) => {
            if(confirm("Delete this product?")) {
              await deleteProductFromDB(e.target.dataset.id);
              load();
            }
          })
        });
      } catch (err) {
        list.innerHTML = "Error loading data. Check console.";
        console.error(err);
      }
    }

    // 2. Upload & Add
    document.getElementById('addBtn').addEventListener('click', async () => {
      const btn = document.getElementById('addBtn');
      const fileInput = document.getElementById('p-file');
      
      const name = document.getElementById('p-name').value;
      const price = document.getElementById('p-price').value;
      
      if(!name || !price || fileInput.files.length === 0) {
        return alert("Please fill Name, Price and select an Image.");
      }

      btn.innerText = "Uploading Image...";
      btn.disabled = true;

      try {
        // A. Upload Image to ImgBB
        const file = fileInput.files[0];
        const imageUrl = await uploadImage(file);

        // B. Save Product to Firebase
        btn.innerText = "Saving Data...";
        
        const newItem = {
          name: name,
          type: document.getElementById('p-type').value,
          price: Number(price),
          stock: Number(document.getElementById('p-stock').value),
          image: imageUrl, 
          desc: document.getElementById('p-desc').value
        };

        await addProductToDB(newItem);
        
        alert("Success! Product is live.");
        
        // Reset Form
        document.getElementById('p-name').value = "";
        document.getElementById('p-price').value = "";
        document.getElementById('p-desc').value = "";
        fileInput.value = ""; 
        load(); 

      } catch (error) {
        console.error(error);
        alert("Error: " + error.message);
      } finally {
        btn.innerText = "Upload & Save";
        btn.disabled = false;
      }
    });

    load(); // Start
  </script>
</body>
</html>